(function(a){typeof define=="function"&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function f(a){this.container=a,this.init()}function g(b,c){this.widget=b,this.options=a.extend({},c),this.detectService(),this.service&&this.init()}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a=a.replace("{"+c+"}",encodeURIComponent(b[c])));return a}function i(a,b){for(var c in b)b.hasOwnProperty(c)&&(a=a.replace("{"+c+"}",b[c]));return a}function j(a,c){var d=b+a;return d+" "+d+"_"+c}function k(b){var d=a(document),e="click.social-likes"+Math.random();d.on(e,function(f){a(f.target).closest(b).length||(b.fadeOut(c),d.off(e))})}function l(a,b){if(document.documentElement.getBoundingClientRect){var d=parseInt(a.css("left"),10),e=parseInt(a.css("top"),10);a.css("visibility","hidden").show();var f=a[0].getBoundingClientRect();f.left<b?a.css("left",b-f.left+d):f.right>window.innerWidth-b&&a.css("left",window.innerWidth-f.right-b+d),f.top<b?a.css("top",b-f.top+e):f.bottom>window.innerHeight-b&&a.css("top",window.innerHeight-f.bottom-b+e),a.hide().css("visibility","visible")}a.fadeIn(c)}"use strict";var b="social-likes__",c="fast",d={facebook:{counterUrl:"http://graph.facebook.com/?ids={url}&callback=?",convertNumber:function(a){for(var b in a)if(a.hasOwnProperty(b))return a[b].shares},popupUrl:"http://www.facebook.com/sharer/sharer.php?u={url}",pupupWidth:600,popupHeight:500},twitter:{counterUrl:"http://urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://twitter.com/intent/tweet?url={url}&text={title}",pupupWidth:600,popupHeight:450,additionalParams:["via","related"]},mailru:{counterUrl:"http://connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(a){for(var b in a)if(a.hasOwnProperty(b))return a[b].shares},popupUrl:"http://connect.mail.ru/share?share_url={url}&title={title}",pupupWidth:550,popupHeight:360},vkontakte:{counterUrl:"http://vkontakte.ru/share.php?act=count&url={url}&index={index}",counter:function(b,c){var e=d.vkontakte;e._||(e._=[],window.VK={Share:{count:function(a,b){e._[a].resolve(b)}}});var f=e._.length;e._.push(c),a.ajax({url:h(b,{index:f}),dataType:"jsonp"})},popupUrl:"http://vk.com/share.php?url={url}&title={title}",pupupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:"http://www.odnoklassniki.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(b,c){var e=d.odnoklassniki;e._||(e._=[],window.ODKL={updateCount:function(a,b){e._[a].resolve(b)}});var f=e._.length;e._.push(c),a.ajax({url:h(b,{index:f}),dataType:"jsonp"})},popupUrl:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={url}",pupupWidth:550,popupHeight:360},plusone:{popupUrl:"https://plus.google.com/share?url={url}",pupupWidth:700,popupHeight:500},code:{click:function(d){var e=this._codeBalloon;if(e){if(e.is(":visible")){e.fadeOut(c);return}}else e=a(i('<div class="'+b+'balloon">'+'<div class="'+b+'balloon__arrow"></div>'+"{prompt}<br>"+'<textarea class="'+b+'balloon__code">{html}</textarea>'+"</div>",{prompt:this.widget.data("prompt")||"Copy code to clipboard:",html:this.options.pageHtml})),this.widget.append(e),this._codeBalloon=e;e.fadeIn(c),e.find("textarea").select(),e.is(":visible")&&(e.removeClass(b+"balloon_right"),e.offset().left<0&&e.addClass(b+"balloon_right"),k(e))}},livejournal:{click:function(b){var c=this._livejournalForm;if(!c){var d=this.options.pageHtml.replace(/&/g,"&amp;").replace(/"/g,"&quot;");c=a(i('<form action="http://www.livejournal.com/update.bml" method="post" target="_blank"><input type="hidden" name="mode" value="full"><input type="hidden" name="subject" value="{title}"><input type="hidden" name="event" value="{html}"></form>',{title:this.options.pageTitle,html:d})),this.widget.append(c),this._livejournalForm=c}c.submit()}}},e={promises:{},fetch:function(b,c){e.promises[b]||(e.promises[b]={});var f=e.promises[b];if(f[c])return f[c];var g=d[b],i=a.Deferred(),j=g.counterUrl&&h(g.counterUrl,{url:c});return a.isFunction(g.counter)?g.counter(j,i):g.counterUrl&&a.getJSON(j).done(function(b){try{var c=b;a.isFunction(g.convertNumber)&&(c=g.convertNumber(b)),i.resolve(c)}catch(d){i.reject(d)}}),f[c]=i.promise(),f[c]}};a.fn.socialLikes=function(){return this.each(function(){new f(a(this))})},f.prototype={optionsMap:{pageUrl:{attr:"url",defaultValue:function(){return window.location.href.replace(window.location.hash,"")}},pageTitle:{attr:"title",defaultValue:function(){return document.title}},pageHtml:{attr:"html",defaultValue:function(){return'<a href="'+this.options.pageUrl+'">'+this.options.pageTitle+"</a>"}},pageCounters:{attr:"counters",defaultValue:"yes",convert:function(a){return a==="yes"}}},init:function(){this.readOptions(),this.single=this.container.hasClass("social-likes_single"),this.initUserButtons(),this.single&&this.container.on("counter.social-likes",a.proxy(this.updateCounter,this));var b=this.options;this.container.find("li").each(function(){new g(a(this),b)}),this.single&&this.makeSingleButton()},readOptions:function(){this.options={};for(var b in this.optionsMap){var c=this.optionsMap[b];this.options[b]=this.container.data(c.attr)||(a.isFunction(c.defaultValue)?a.proxy(c.defaultValue,this)():c.defaultValue),a.isFunction(c.convert)&&(this.options[b]=c.convert(this.options[b]))}},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&a.extend(d,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){var d=this.container;d.addClass("social-likes_vertical"),d.wrap(a("<div>",{"class":"social-likes_single-w"}));var e=d.parent(),f=parseInt(d.css("left"),10),g=parseInt(d.css("top"),10);d.hide();var h=a("<div>",{"class":j("button","single"),text:d.data("single-title")||"Share"});h.prepend(a("<span>",{"class":j("icon","single")})),e.append(h);var i=a("<li>",{"class":b+"close",html:"&times;"});d.append(i),this.number=0,h.click(function(){return d.css({left:f,top:g}),l(d,20),k(d),!1}),i.click(function(){d.fadeOut(c)}),this.wrapper=e},updateCounter:function(a,b){if(!b)return;this.number+=b,this.getCounterElem().text(this.number)},getCounterElem:function(){var c=this.wrapper.find("."+b+"counter_single");return c.length||(c=a("<span>",{"class":j("counter","single")}),this.wrapper.append(c)),c}},g.prototype={init:function(){this.detectParams(),this.initHtml(),this.options.pageCounters&&(this.options.counterNumber?this.updateCounter(this.options.counterNumber):e.fetch(this.service,this.options.pageUrl).done(a.proxy(this.updateCounter,this)))},detectService:function(){var b=this.widget[0].classList||this.widget[0].className.split(" ");for(var c=0;c<b.length;c++){var e=b[c];if(d[e]){this.service=e,a.extend(this.options,d[e]);return}}},detectParams:function(){var a=this.widget.data("counter");if(a){var b=parseInt(a);isNaN(b)?this.options.counterUrl=a:this.options.counterNumber=b}},initHtml:function(){var b=this.options,c=this.widget,d=!!b.clickUrl;c.removeClass(this.service),c.addClass(this.getElementClassNames("widget"));var e=c.find("a");e.length&&this.cloneDataAttrs(e,c);var f=a(d?"<a>":"<span>",{"class":this.getElementClassNames("button"),text:c.text()});if(d){var g=h(b.clickUrl,{url:b.pageUrl,title:b.pageTitle});f.attr("href",g)}else f.click(a.proxy(this.click,this));f.prepend(a("<span>",{"class":this.getElementClassNames("icon")})),c.empty().append(f),this.button=f},cloneDataAttrs:function(a,b){var c=a.data();for(var d in c)c.hasOwnProperty(d)&&b.data(d,c[d])},getElementClassNames:function(a){return j(a,this.service)},updateCounter:function(b){b=parseInt(b,10);if(!b)return;var c=a("<span>",{"class":this.getElementClassNames("counter"),text:b});this.widget.append(c),this.widget.trigger("counter.social-likes",b)},click:function(b){var c=this.options;if(a.isFunction(c.click))c.click.call(this,b);else{var d=h(c.popupUrl,{url:c.pageUrl,title:c.pageTitle});d=this.addAdditionalParamsToUrl(d),this.openPopup(d,{width:c.pupupWidth,height:c.popupHeight})}return!1},addAdditionalParamsToUrl:function(b){var c=this.options.additionalParams;if(!c)return b;var d={};for(var e=0;e<c.length;e++){var f=c[e],g=this.widget.data(f);g&&(d[f]=g)}var h=b.indexOf("?")===-1?"?":"&";return b+h+a.param(d)},openPopup:function(a,b){var c=Math.round(screen.width/2-b.width/2),d=0;screen.height>b.height&&(d=Math.round(screen.height/3-b.height/2));var e=window.open(a,"sl_"+this.service,"left="+c+",top="+d+","+"width="+b.width+",height="+b.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");e?e.focus():location.href=a}},a(function(){a(".social-likes").socialLikes()})})