(function(a){typeof define=="function"&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function d(a){this.container=a,this.init()}function e(b,c){this.widget=b,this.options=a.extend({},c),this.detectService(),this.service&&this.init()}function f(a,b){for(var c in b)a=a.replace("{"+c+"}",encodeURIComponent(b[c]).replace(/\+/g,"%2B"));return a}function g(a,b){for(var c in b)a=a.replace("{"+c+"}",b[c]);return a}var b={facebook:{counterUrl:"http://graph.facebook.com/?ids={url}&callback=?",convertNumber:function(a){for(var b in a)return a[b].shares},popupUrl:"http://www.facebook.com/sharer/sharer.php?u={url}",pupupWidth:600,popupHeight:500},twitter:{counterUrl:"http://urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://twitter.com/intent/tweet?url={url}&text={title}",pupupWidth:600,popupHeight:450,additionalParams:["via","related"]},mailru:{counterUrl:"http://connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(a){for(var b in a)return a[b].shares},popupUrl:"http://connect.mail.ru/share?share_url={url}",pupupWidth:550,popupHeight:360},vkontakte:{counterUrl:"http://vkontakte.ru/share.php?act=count&url={url}&index={index}",counter:function(c,d){var e=b.vkontakte;e._||(e._=[],window.VK={Share:{count:function(a,b){e._[a].resolve(b)}}});var g=e._.length;e._.push(d),a.ajax({url:f(c,{index:g}),dataType:"jsonp"})},popupUrl:"http://vk.com/share.php?url={url}&title={title}",pupupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:"http://www.odnoklassniki.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(c,d){var e=b.odnoklassniki;e._||(e._=[],window.ODKL={updateCount:function(a,b){e._[a].resolve(b)}});var g=e._.length;e._.push(d),a.ajax({url:f(c,{index:g}),dataType:"jsonp"})},popupUrl:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={url}",pupupWidth:550,popupHeight:360},plusone:{popupUrl:"https://plus.google.com/share?url={url}",pupupWidth:700,popupHeight:500},code:{click:function(b){var c=this._codeBalloon;c?c.toggle():(c=a(g('<div class="social-likes__balloon"><div class="social-likes__balloon__arrow"></div>{prompt}<br><textarea class="social-likes__balloon__code">{html}</textarea></div>',{prompt:this.widget.data("prompt")||"Copy code to clipboard:",html:this.options.pageHtml})),this.widget.append(c),this._codeBalloon=c),c.find("textarea").select();if(c.is(":visible")){var d=a(document),e="click.social-likes__hide-code";d.on(e,function(a){a.target.tagName!=="TEXTAREA"&&(c.hide(),d.off(e))})}}},livejournal:{click:function(b){var c=this._livejournalForm;if(!c){var d=this.options.pageHtml.replace(/&/g,"&amp;").replace(/"/g,"&quot;");c=a(g('<form action="http://www.livejournal.com/update.bml" method="post" target="_blank"><input type="hidden" name="mode" value="full"><input type="hidden" name="subject" value="{title}"><input type="hidden" name="event" value="{html}"></form>',{title:this.options.pageTitle,html:d})),this.widget.append(c),this._livejournalForm=c}c.submit()}}},c={promises:{},fetch:function(d,e){c.promises[d]||(c.promises[d]={});var g=c.promises[d];if(g[e])return g[e];var h=b[d],i=a.Deferred(),j=h.counterUrl&&f(h.counterUrl,{url:e});return typeof h.counter=="function"?h.counter(j,i):h.counterUrl&&a.getJSON(j).done(function(a){try{var b=a;typeof h.convertNumber=="function"&&(b=h.convertNumber(a)),i.resolve(b)}catch(c){throw c}}),g[e]=i.promise(),g[e]}};a.fn.socialLikes=function(){return this.each(function(){new d(a(this))})},d.prototype={init:function(){var b={pageUrl:this.pageUrl(),pageTitle:this.pageTitle(),pageHtml:this.pageHtml()};this.container.find("li").each(function(){new e(a(this),b)})},pageUrl:function(){return"http://mail.ru"},pageTitle:function(){return this.container.data("title")||document.title},pageHtml:function(){return this.container.data("html")||'<a href="'+this.pageUrl()+'">'+this.pageTitle()+"</a>"}},e.prototype={prefix:"social-likes__",init:function(){this.detectParams(),this.initHtml(),this.setEventHandlers(),c.fetch(this.service,this.options.pageUrl).done(a.proxy(this.updateCounter,this))},detectService:function(){var c=this.widget[0].classList||this.widget[0].className.split(" ");for(var d=0;d<c.length;d++){var e=c[d];if(b[e]){this.service=e,a.extend(this.options,b[e]);return}}},detectParams:function(){var a=this.widget.data("counter-url");a&&(this.options.counterUrl=a)},initHtml:function(){var b=this.widget;b.removeClass(this.service),b.addClass(this.getElementClassNames("widget"));var c=b.find("a");c.length&&this.cloneDataAttrs(c,b);var d=a("<span>",{"class":this.getElementClassNames("button"),text:b.text()});d.prepend(a("<span>",{"class":this.getElementClassNames("icon")})),b.empty().append(d),this.button=d},cloneDataAttrs:function(a,b){var c=a.data();for(var d in c)b.data(d,c[d])},getElementClassNames:function(a){var b=this.prefix+a;return b+" "+b+"_"+this.service},setEventHandlers:function(){this.button.click(a.proxy(this.click,this))},updateCounter:function(b){b=parseInt(b,10);if(!b)return;var c=a("<span>",{"class":this.getElementClassNames("counter"),html:b});this.widget.append(c)},click:function(a){var b=this.options;if(typeof b.click=="function")b.click.call(this,a);else{var c=f(b.popupUrl,{url:b.pageUrl,title:b.pageTitle});c=this.addAdditionalParamsToUrl(c),this.openPopup(c,{width:b.pupupWidth,height:b.popupHeight})}return!1},addAdditionalParamsToUrl:function(b){var c=this.options.additionalParams;if(!c)return b;var d={};for(var e=0;e<c.length;e++){var f=c[e],g=this.widget.data(f);g&&(d[f]=g)}var h=b.indexOf("?")===-1?"?":"&";return b+h+a.param(d)},openPopup:function(a,b){var c=Math.round(screen.width/2-b.width/2);top=0,screen.height>b.height&&(top=Math.round(screen.height/3-b.height/2));var d=window.open(a,this.prefix+this.service,"left="+c+",top="+top+","+"width="+b.width+",height="+b.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");d?d.focus():location.href=a}},a(function(){a(".social-likes").socialLikes()})})